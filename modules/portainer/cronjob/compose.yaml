services:
  hypervisor:
    image: crazymax/swarm-cronjob
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
    environment:
      TZ: "Europe/Amsterdam"
      LOG_LEVEL: "info"
      LOG_JSON: "false"
    deploy:
      placement:
        constraints:
          - node.role == manager
    networks:
      - proxy_network

  healthchecks:
    image: healthchecks/healthchecks:latest
    environment:
      - DB=sqlite
      - DB_NAME=/data/hc.sqlite
      - DEBUG=False
      - SECRET_KEY_FILE=/run/secrets/secret_key
      - SITE_ROOT=https://healthchecks.denyssizomin.com
      - ALLOWED_HOSTS=tasks.cronjob_healthchecks,healthchecks.denyssizomin.com
      - REMOTE_USER_HEADER=HTTP_X_AUTHENTIK_EMAIL
    volumes:
      - healthchecks-data:/data
    networks:
      - proxy_network
    secrets:
      - secret_key

secrets:
  secret_key:
    name: ${SECRET_KEY}
    external: true

volumes:
  healthchecks-data:

networks:
  proxy_network:
    name: ${PROXY_NETWORK}
    external: true
